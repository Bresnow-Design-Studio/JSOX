"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=e||{};const t=JSON,n=e;n.version="1.2.107";const r="function"==typeof BigInt,s=["ab","u8","cu8","s8","u16","s16","u32","s32","u64","s64","f32","f64"];var a=null,i=null;const o=[ArrayBuffer,Uint8Array,Uint8ClampedArray,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,null,null,Float32Array,Float64Array],l={true:!0,false:!1,null:null,NaN:NaN,Infinity:1/0,undefined:void 0},c=[];function u(){var e=c.pop();return e||(e={context:0,current_proto:null,current_class:null,current_class_field:0,arrayType:-1,valueType:0,elements:null}),e}function f(e){c.push(e)}const p=[];function g(e){p.push(e)}n.escape=function(e){var t,n="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(n+="\\"),n+=e[t];return n};const h=new WeakMap,b=new Map,y=new Map,d=[];n.begin=function(e,t){const n={name:null,value_type:0,string:"",contains:null,className:null},a={line:1,col:1};let i,l=0;var c=new Map,h=0,b=!0,d=!1,m=!1,v=null,k=null,w=void 0,_={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t,this.length++},pop(){var e=this.last;return(this.last=e.prior)||(this.first=null),e.next=this.saved,this.last&&(this.last.next=null),e.next||(e.first=null),this.saved=e,this.length--,e.node},length:0},x=[],N={},j=null,S=null,E=0,A=-1,I=0,T=0,D=!1,P=!1,X=!1,C=!1,J=!1,M={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t},shift(){var e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){var t=this.saved;this.saved=t.next,t.node=e,t.next=this.first,t.prior=null,this.first||(this.last=t),this.first=t}},F=null,$=!1,U=!1,B=!1,q=!1,H=!1,R=!1,W=!1,z=0,L=0,Y=!1,G=!1,V=!1;function K(e){throw new Error(`${e} at ${l} [${a.line}:${a.col}]`)}return{fromJSOX(e,t,n){if(c.get(e))throw new Error("Existing fromJSOX has been registered for prototype");if(t||(t=function(){}),t&&!("constructor"in t))throw new Error("Please pass a prototype like thing...");c.set(e,{protoCon:t.prototype.constructor,cb:n})},registerFromJSOX(e,t){throw new Error("registerFromJSOX is deprecated, please update to use fromJSOX instead:"+e+t.toString())},finalError(){0!==T&&(1===T&&K("Comment began at end of document"),3===T&&K("Open comment '/*' is missing close at end of document"),4===T&&K("Incomplete '/* *' close at end of document")),$&&K("Incomplete string")},value(){this.finalError();var e=v;return v=void 0,e},reset(){h=0,b=!0,M.last&&(M.last.next=M.save),M.save=M.first,M.first=M.last=null,_.last&&(_.last.next=_.save),_.length=0,_.save=M.first,_.first=_.last=null,w=void 0,I=0,x=[],N={},j=null,S=null,E=0,n.value_type=0,n.name=null,n.string="",n.className=null,a.line=1,a.col=1,m=!1,T=0,Y=!1,$=!1,B=!1,q=!1,G=!1},usePrototype(e,t){N[e]=t},write(n){var r;if("string"!=typeof n&&void 0!==n&&(n=String(n)),!b)throw new Error("Parser is still in an error state, please reset before resuming");for(r=this._write(n,!1);r>0&&("function"==typeof t&&function e(n,r){var s,a,i=n[r];if(i&&"object"==typeof i)for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(void 0!==(a=e(i,s))?i[s]=a:delete i[s]);return t.call(n,r,i)}({"":v},""),v=e(v),!(r<2));r=this._write());},_write(e,t){var N,K,Q,Z=0;function ee(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${l} (near '${Q.substr(l>4?l-4:0,l>4?3:l-1)}[${String.fromCodePoint(t)}]${Q.substr(l,10)}') [${a.line}:${a.col}]`)}function te(){n.value_type=0,n.string="",n.contains=null}function ne(){var e=null;switch(n.value_type){case 5:if(!(n.string.length>13||13==n.string.length&&n[0]>"2")||G||J||C||P||(V=!0),V){if(r)return BigInt(n.string);throw new Error("no builtin BigInt()",0)}if(G){const e=new Date(n.string);return isNaN(e.getTime())&&ee("Bad number format",N),e}return(m?-1:1)*Number(n.string);case 4:if(n.className){if((e=c.get(n.className))||(e=y.get(n.className)),e&&e.cb)return n.className=null,e.cb.call(n.string);throw new Error("Double string error, no constructor for: new "+n.className+"("+n.string+")")}return n.string;case 2:return!0;case 3:return!1;case 7:case 8:return NaN;case 9:return-1/0;case 10:return 1/0;case 1:return null;case-1:case 12:return;case 6:return n.className&&((e=c.get(n.className))||(e=y.get(n.className)),n.className=null,e&&e.cb)?n.contains=e.cb.call(n.contains):n.contains;case 13:if(A>=0){let e;return e=n.contains.length?O(n.contains[0]):O(n.string),0===A?e:new o[A](e)}if(-2===A){var t=k;let e;const r=n.contains.length;for(e=0;e<r;e++){const s=n.contains[e];let a=t[s];if(!a){let s=_.first,i=0;for(;s&&i<r&&i<_.length;){const r=n.contains[i];if(r in t)break;if(s.next)if("number"==typeof r){const e=s.next.node.elements,n=s.next.node.elements;if(e&&r>=e.length){if(i===n.length-1){console.log("This is actually at the current object so use that"),a=w;break}if(s.next.next&&r===e.length){a=s.next.next.node.elements,s=s.next,i++,t=a;continue}a=w,i++;break}}else{if(r!==s.next.node.name){a=s.next.node.elements[r],e=i;break}a=13===s.next.node.valueType?s.next.node.elements_array:s.next.node.elements[r]}else a=a[r];s=s.next,i++}e=i<r?i-1:i}if(!a)throw new Error("Path did not resolve properly:"+n.contains+" at "+s+"("+e+")");t=a}return A=-3,t}return n.className&&((e=c.get(n.className))||(e=y.get(n.className)),n.className=null,e&&e.cb)?e.cb.call(n.contains):n.contains;default:console.log("Unhandled value conversion.",n)}}function re(){if(-3==A)return 6===n.value_type&&w.push(n.contains),void(A=-1);switch(n.value_type){case 12:w.push(void 0),delete w[w.length-1];break;default:w.push(ne())}te()}function se(){if(-3===A&&13===n.value_type)return te(),void(A=-1);if(12===n.value_type)return;!n.name&&S&&(n.name=S.fields[E++]);let e=ne();j&&j.protoDef&&j.protoDef.cb?(e=j.protoDef.cb.call(w,n.name,e),e&&(w[n.name]=e)):w[n.name]=e,te()}function ae(e){if(0!==h){switch(m&&ee("Negative outside of quotes, being converted to a string (would lose count of leading '-' characters)",e),h){case 31:switch(n.value_type){case 2:n.string+="true";break;case 3:n.string+="false";break;case 1:n.string+="null";break;case 10:n.string+="Infinity";break;case 9:n.string+="-Infinity",ee("Negative outside of quotes, being converted to a string",e);break;case 8:n.string+="NaN";break;case 7:n.string+="-NaN",ee("Negative outside of quotes, being converted to a string",e);break;case-1:n.string+="undefined";break;case 4:case 0:break;default:console.log("Value of type "+n.value_type+" is not restored...")}break;case 1:n.string+="t";break;case 2:n.string+="tr";break;case 3:n.string+="tru";break;case 5:n.string+="f";break;case 6:n.string+="fa";break;case 7:n.string+="fal";break;case 8:n.string+="fals";break;case 9:n.string+="n";break;case 10:n.string+="nu";break;case 11:n.string+="nul";break;case 12:n.string+="u";break;case 13:n.string+="un";break;case 14:n.string+="und";break;case 15:n.string+="unde";break;case 16:n.string+="undef";break;case 17:n.string+="undefi";break;case 18:n.string+="undefin";break;case 19:n.string+="undefine";break;case 20:n.string+="M";break;case 21:n.string+="Na";break;case 22:n.string+="I";break;case 23:n.string+="In";break;case 24:n.string+="Inf";break;case 25:n.string+="Infi";break;case 26:n.string+="Infin";break;case 27:n.string+="Infini";break;case 28:n.string+="Infinit";break;case 0:case 29:case 30:break;case 32:ee("String-keyword recovery fail (after whitespace)",e)}n.value_type=4,h<29&&(h=31)}else h=31,n.value_type=4;if(123==e)le();else if(91==e)ce();else if(44==e);else{if(32==e||13==e||10==e||9==e||65279==e||8232==e||8233==e)return;44==e||125==e||93==e||58==e?ee("Invalid character near identifier",e):n.string+=i}}function ie(e){let t=0;for(;0==t&&l<Q.length;){i=Q.charAt(l);let r=Q.codePointAt(l++);if(r>=65536&&(i+=Q.charAt(l),l++),a.col++,r==e)B?(W?ee("Incomplete hexidecimal sequence",r):R?ee("Incomplete long unicode sequence",r):H&&ee("Incomplete unicode sequence",r),q?(q=!1,t=1):n.string+=i,B=!1):t=1;else if(B){if(H){if(125==r){n.string+=String.fromCodePoint(z),H=!1,R=!1,B=!1;continue}if(z*=16,r>=48&&r<=57)z+=r-48;else if(r>=65&&r<=70)z+=r-65+10;else{if(!(r>=97&&r<=102)){ee("(escaped character, parsing hex of \\u)",r),t=-1,H=!1,B=!1;continue}z+=r-97+10}continue}if(W||R){if(0===L&&123===r){H=!0;continue}if(L<2||R&&L<4){if(z*=16,r>=48&&r<=57)z+=r-48;else if(r>=65&&r<=70)z+=r-65+10;else{if(!(r>=97&&r<=102)){ee(R?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",r),t=-1,W=!1,B=!1;continue}z+=r-97+10}L++,R?4==L&&(n.string+=String.fromCodePoint(z),R=!1,B=!1):2==L&&(n.string+=String.fromCodePoint(z),W=!1,B=!1);continue}}switch(r){case 13:q=!0,a.col=1;continue;case 8232:case 8233:a.col=1;case 10:q?q=!1:a.col=1,a.line++;break;case 116:n.string+="\t";break;case 98:n.string+="\b";break;case 110:n.string+="\n";break;case 114:n.string+="\r";break;case 102:n.string+="\f";break;case 48:n.string+="\0";break;case 120:W=!0,L=0,z=0;continue;case 117:R=!0,L=0,z=0;continue;default:n.string+=i}B=!1}else 92===r?B?(n.string+="\\",B=!1):(B=!0,z=0,L=0):(q&&(q=!1,a.line++,a.col=2),n.string+=i)}return t}function oe(){let e;for(;(e=l)<Q.length;){i=Q.charAt(e);let r=Q.codePointAt(l++);if(r>=256){l=e;break}if(95!=r)if(a.col++,r>=48&&r<=57)X&&(J=!0),n.string+=i;else if(45==r||43==r)0==n.string.length||X&&!C&&!J?(45!=r||X||(m=!m),n.string+=i,C=!0):(n.string+=i,G=!0);else{if(78==r){if(0==h)return U=!1,void(h=20);ee("fault while parsing number;",r);break}if(73==r){if(0==h)return U=!1,void(h=22);ee("fault while parsing number;",r);break}if(58==r&&G)n.string+=i,G=!0;else if(84==r&&G)n.string+=i,G=!0;else if(90==r&&G)n.string+=i,G=!0;else if(46==r){if(P||D||X){b=!1,ee("fault while parsing number;",r);break}n.string+=i,P=!0}else{if(110==r){V=!0;break}if(120==r||98==r||111==r||88==r||66==r||79==r){if(D||"0"!=n.string){b=!1,ee("fault while parsing number;",r);break}D=!0,n.string+=i}else{if(101!=r&&69!=r){if(32==r||13==r||10==r||9==r||47==r||35==r||44==r||125==r||93==r||123==r||91==r||34==r||39==r||96==r||58==r){l=e;break}t&&(b=!1,ee("fault while parsing number;",r));break}if(X){b=!1,ee("fault while parsing number;",r);break}n.string+=i,X=!0}}}}t||l!=Q.length?(U=!1,n.value_type=5,0==I&&(Y=!0)):U=!0}function le(){let e,t=2,r=null,s={};if(h>0&&h<29&&ae(123),e=ue(),0==I)if(29==h||31==h&&(e||n.string.length)){if(e&&e.protoDef&&e.protoDef.protoCon&&(s=new e.protoDef.protoCon),!e||!e.protoDef&&n.string){if(r=x.find((e=>e.name===n.string)),console.log("Probably creating the Macro-Tag here?",r),r)d?(r.fields.length=0,t=4):(s=new r.protoCon,t=5);else{function a(){}x.push(r={name:n.string,protoCon:e&&e.protoDef&&e.protoDef.protoCon||a.constructor,fields:[]}),t=4}d=!1}S=r,h=0}else h=29;else if(29==h||1===I||3===I||5==I)if(0!=h||4==n.value_type){if(e&&e.protoDef)s=new e.protoDef.protoCon;else if(r=x.find((e=>e.name===n.string)),r)t=5,s={};else{function a(){}c.set(n.string,{protoCon:a.prototype.constructor,cb:null}),s=new a}h=0}else h=0;else if(2==I&&0==h)return ee("fault while parsing; getting field name unexpected ",N),b=!1,!1;let i=u();return n.value_type=6,0===I?w=s:1==I||3!=I&&5!=I||(!n.name&&S&&(n.name=S.fields[E++]),w[n.name]=s),i.context=I,i.elements=w,i.name=n.name,i.current_proto=j,i.current_class=S,i.current_class_field=E,i.valueType=n.value_type,i.arrayType=A,i.className=n.className,n.className=null,n.name=null,j=e,S=r,E=0,w=s,k||(k=w),_.push(i),te(),I=t,!0}function ce(){if(h>0&&h<29&&ae(91),31==h&&n.string.length){var e=s.findIndex((e=>e===n.string));e>=0?(h=0,A=e,n.className=n.string,n.string=null):"ref"===n.string?(n.className=null,A=-2):c.get(n.string)||y.get(n.string)?n.className=n.string:ee(`Unknown type '${n.string}' specified for array`,N)}else if(2==I||29==h||30==h)return ee("Fault while parsing; while getting field name unexpected",N),b=!1,!1;{let e=u();n.value_type=13;let t=[];if(0==I)w=t;else if(1==I)-1==A&&w.push(t);else if(3==I)if(n.name||(console.log("This says it's resolved......."),A=-3),j&&j.protoDef)if(j.protoDef.cb){const e=j.protoDef.cb.call(w,n.name,t);void 0!==e?t=w[n.name]=e:console.log("Warning: Received undefined for an array; keeping original array, not setting field")}else w[n.name]=t;else w[n.name]=t;e.context=I,e.elements=w,e.name=n.name,e.current_proto=j,e.current_class=S,e.current_class_field=E,e.valueType=n.value_type,e.arrayType=-1==A?-3:A,e.className=n.className,A=-1,n.className=null,n.name=null,j=null,S=null,E=0,w=t,k||(k=t),_.push(e),te(),I=1}return!0}function ue(){const e={protoDef:null,cls:null};return((e.protoDef=c.get(n.string))||(e.protoDef=y.get(n.string)))&&(n.className||(n.className=n.string,n.string=null)),n.string&&(e.cls=x.find((e=>e.name===n.string))),e.protoDef||e.cls?e:null}if(!b)return-1;for(e&&e.length?((K=function(){var e=p.pop();return e?e.n=0:e={buf:null,n:0},e}()).buf=e,M.push(K)):(U&&(U=!1,n.value_type=5,0==I&&(Y=!0),Z=1),0!==I&&ee("Unclosed object at end of stream.",N));b&&(K=M.shift());){if(l=K.n,Q=K.buf,$){let e=ie(F);e<0?b=!1:e>0&&($=!1,b&&(n.value_type=4))}for(U&&oe();!Y&&b&&l<Q.length;)if(i=Q.charAt(l),(N=Q.codePointAt(l++))>=65536&&(i+=Q.charAt(l),l++),a.col++,T)if(1==T)if(42==N)T=3;else{if(47!=N)return ee("fault while parsing;",N);T=2}else 2==T?10!=N&&13!=N||(T=0):3==T?42==N&&(T=4):T=47==N?0:3;else{switch(N){case 47:T=1;break;case 123:le();break;case 91:ce();break;case 58:if(5==I)h=0,n.name=n.string,n.string="",n.value_type=0;else if(2==I||4==I)if(4==I){if(!Object.keys(w).length){console.log("This is a full object, not a class def...",n.className);const e=()=>{};c.set(_.last.node.current_class.name,{protoCon:e.prototype.constructor,cb:null}),w=new e,I=3,n.name=n.string,h=0,n.string="",n.value_type=0,console.log("don't do default;s do a revive...")}}else 0!=h&&31!=h&&29!=h&&30!=h&&ae(32),h=0,n.name=n.string,n.string="",I=2===I?3:6,n.value_type=0;else{if(0==I){console.log("Override colon found, allow class redefinition",I),d=!0;break}ee(1==I?"(in array, got colon out of string):parsing fault;":3==I?"String unexpected":"(outside any object, got colon out of string):parsing fault;",N),b=!1}break;case 125:if(31==h&&(h=0),4==I)if(S){n.string&&S.fields.push(n.string),te();let e=_.pop();I=0,h=0,n.name=e.name,w=e.elements,S=e.current_class,E=e.current_class_field,A=e.arrayType,n.value_type=e.valueType,n.className=e.className,k=null,f(e)}else ee("State error; gathering class fields, and lost the class",N);else if(2==I||5==I){0!=n.value_type&&(S&&(n.name=S.fields[E++]),se()),n.value_type=6,j&&j.protoDef&&(console.log("SOMETHING SHOULD AHVE BEEN REPLACED HERE??",j),console.log("The other version only revives on init"),w=new j.protoDef.cb(w,void 0,void 0)),n.contains=w,n.string="";let e=_.pop();I=e.context,n.name=e.name,w=e.elements,S=e.current_class,j=e.current_proto,E=e.current_class_field,A=e.arrayType,n.value_type=e.valueType,n.className=e.className,f(e),0==I&&(Y=!0)}else if(3==I){0===n.value_type&&ee("Fault while parsing; unexpected",N),se(),n.value_type=6,n.contains=w,h=0;var fe=_.pop();I=fe.context,n.name=fe.name,w=fe.elements,j=fe.current_proto,S=fe.current_class,E=fe.current_class_field,A=fe.arrayType,n.value_type=fe.valueType,n.className=fe.className,f(fe),0==I&&(Y=!0)}else ee("Fault while parsing; unexpected",N),b=!1;m=!1;break;case 93:if(h>=30&&(h=0),1==I){0!=n.value_type&&(n.name&&console.log("Ya this should blow up"),re()),n.contains=w;{let e=_.pop();n.name=e.name,n.className=e.className,I=e.context,w=e.elements,j=e.current_proto,S=e.current_class,E=e.current_class_field,A=e.arrayType,n.value_type=e.valueType,f(e)}n.value_type=13,0==I&&(Y=!0)}else ee(`bad context ${I}; fault while parsing`,N),b=!1;m=!1;break;case 44:h<30&&0!=h&&ae(N),31!=h&&29!=h||(h=0),4==I?S?(console.log("Saving field name(set word to IS A FIELD):",n.string),S.fields.push(n.string),n.string="",h=29):ee("State error; gathering class fields, and lost the class",N):2==I?S?(n.name=S.fields[E++],0!=n.value_type&&(se(),te())):(n.string||n.value_type)&&ee("State error; comma in field name and/or lost the class",N):5==I?(S?(-3==A||n.name||(n.name=S.fields[E++]),0!=n.value_type&&(-3!=A&&se(),te())):0!=n.value_type&&(se(),te()),n.name=null):1==I?(0==n.value_type&&(n.value_type=12),re(),te(),h=0):3==I&&0!=n.value_type?(I=2,0!=n.value_type&&(se(),te()),h=0):(b=!1,ee("bad context; excessive commas while parsing;",N)),m=!1;break;default:switch(N){default:if(0!=I&&(3!=I||29!=h)&&2!=I&&29!=h&&4!=I){if(0==h&&(N>=48&&N<=57||43==N||46==N||45==N))D=!1,X=!1,G=!1,V=!1,C=!1,J=!1,P=!1,n.string=i,K.n=l,oe();else if(0==n.value_type)0!=h?ae(N):(h=31,n.string+=i,n.value_type=4);else if(2==I)ee("Multiple values found in field name",N);else if(3==I)if(4!=n.value_type&&(6!=n.value_type&&13!=n.value_type||ee("String unexpected",N),ae(N)),30==h){ue()?n.string=i:ee("String unexpected",N)}else 31==h?n.string+=i:ee("String unexpected",N);else if(1==I){if(30==h){n.className||(n.className=n.string,n.string=""),n.string+=i;break}31==h&&(n.string+=i)}break}switch(N){case 96:case 34:case 39:if(0==h||29==h){n.string.length&&(console.log("IN ARRAY AND FIXING?"),n.className=n.string,n.string=""),ie(N)?n.value_type=4:(F=N,$=!0)}else ee("fault while parsing; quote not at start of field name",N);break;case 10:a.line++,a.col=1;case 13:case 32:case 8232:case 8233:case 9:case 65279:if(0===I&&31===h){h=0,0===I&&(Y=!0);break}if(0===h||30===h){0==I&&n.value_type&&(Y=!0);break}if(29===h){if(0===I){h=0,Y=!0;break}n.string.length&&console.log("STEP TO NEXT TOKEN."),h=30}else b=!1,ee("fault while parsing; whitepsace unexpected",N);break;default:if(0==h&&(N>=48&&N<=57||43==N||46==N||45==N)){D=!1,X=!1,G=!1,V=!1,C=!1,J=!1,P=!1,n.string=i,K.n=l,oe();break}if(30===h&&(b=!1,ee("fault while parsing; character unexpected",N)),0===h){h=29,n.value_type=4,n.string+=i;break}if(0==n.value_type)0!==h&&31!==h&&ae(N);else{if(31===h||29===h){n.string+=i;break}if(2==I){if(29==h){n.string+=i;break}ee("Multiple values found in field name",N)}3==I&&ee("String unexpected",N)}}break;case 96:case 34:case 39:ie(N)?(n.value_type=4,h=31):(F=N,$=!0);break;case 10:a.line++,a.col=1;case 32:case 9:case 13:case 8232:case 8233:case 65279:if(31==h){if(0==I){h=0,Y=!0;break}if(3==I){h=32;break}if(2==I){h=30;break}if(1==I){h=30;break}}if(0==h||30==h)break;29==h?n.string.length&&(h=30):h<31&&ae(N);break;case 116:0==h?h=1:27==h?h=28:ae(N);break;case 114:1==h?h=2:ae(N);break;case 117:2==h?h=3:9==h?h=10:0==h?h=12:ae(N);break;case 101:3==h?(n.value_type=2,h=31):8==h?(n.value_type=3,h=31):14==h?h=15:18==h?h=19:ae(N);break;case 110:0==h?h=9:12==h?h=13:17==h?h=18:22==h?h=23:25==h?h=26:ae(N);break;case 100:13==h?h=14:19==h?(n.value_type=-1,h=31):ae(N);break;case 105:16==h?h=17:24==h?h=25:26==h?h=27:ae(N);break;case 108:10==h?h=11:11==h?(n.value_type=1,h=31):6==h?h=7:ae(N);break;case 102:0==h?h=5:15==h?h=16:23==h?h=24:ae(N);break;case 97:5==h?h=6:20==h?h=21:ae(N);break;case 115:7==h?h=8:ae(N);break;case 73:0==h?h=22:ae(N);break;case 78:0==h?h=20:21==h?(n.value_type=m?7:8,m=!1,h=31):ae(N);break;case 121:28==h?(n.value_type=m?9:10,m=!1,h=31):ae(N);break;case 45:0==h?m=!m:ae(N);break;case 43:0!==h&&ae(N)}}if(Y){31==h&&(h=0);break}}if(l==Q.length?(g(K),$||U||2==I?Z=0:0!=I||0==n.value_type&&!v||(Y=!0,Z=1)):(K.n=l,M.unshift(K),Z=2),Y){k=null;break}}return b?(Y&&0!=n.value_type&&(h=0,v=ne(),m=!1,n.string="",n.value_type=0),Y=!1,Z):-1}}};const m=[Object.freeze(n.begin())];var v=0;function k(){return this&&this.valueOf()}n.parse=function(e,t){var r,s=v++;m.length<=s&&m.push(Object.freeze(n.begin())),r=m[s],"string"!=typeof e&&(e=String(e)),r.reset();const a=r._write(e,!0);if(a>0){var i=r.value();if(void 0===i&&a>1)throw new Error("Pending value could not complete");return i="function"==typeof t?function e(n,r){var s,a,i=n[r];if(i&&"object"==typeof i)for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(void 0!==(a=e(i,s))?i[s]=a:delete i[s]);return t.call(n,r,i)}({"":i},""):i,v--,i}r.finalError()},h.set(Object.prototype,{external:!1,name:Object.prototype.constructor.name,cb:null}),h.set(Date.prototype,{external:!1,name:"Date",cb:function(){var e,t,n=-this.getTimezoneOffset(),r=n>=0?"+":"-",s=function(e){var t=Math.floor(Math.abs(e));return(t<10?"0":"")+t};return[this.getFullYear(),"-",s(this.getMonth()+1),"-",s(this.getDate()),"T",s(this.getHours()),":",s(this.getMinutes()),":",s(this.getSeconds()),"."+(e=this.getMilliseconds(),t=Math.floor(Math.abs(e)),(t<100?"0":"")+(t<10?"0":"")+t)+r,s(n/60),":",s(n%60)].join("")}}),h.set(Boolean.prototype,{external:!1,name:"Boolean",cb:k}),h.set(Number.prototype,{external:!1,name:"Number",cb:function(){return isNaN(this)?"NaN":isFinite(this)?String(this):this<0?"-Infinity":"Infinity"}}),h.set(String.prototype,{external:!1,name:"String",cb:function(){return'"'+n.escape(k.apply(this))+'"'}}),"function"==typeof BigInt&&h.set(BigInt.prototype,{external:!1,name:"BigInt",cb:function(){return this+"n"}}),h.set(ArrayBuffer.prototype,{external:!0,name:"ab",cb:function(){return"["+N(this)+"]"}}),h.set(Uint8Array.prototype,{external:!0,name:"u8",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Uint8ClampedArray.prototype,{external:!0,name:"uc8",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Int8Array.prototype,{external:!0,name:"s8",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Uint16Array.prototype,{external:!0,name:"u16",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Int16Array.prototype,{external:!0,name:"s16",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Uint32Array.prototype,{external:!0,name:"u32",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Int32Array.prototype,{external:!0,name:"s32",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Float32Array.prototype,{external:!0,name:"f32",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Float64Array.prototype,{external:!0,name:"f64",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Float64Array.prototype,{external:!0,name:"f64",cb:function(){return"["+N(this.buffer)+"]"}}),h.set(Map.prototype,i={external:!0,name:"map",cb:null}),y.set("map",{protoCon:Map,cb:function(e,t){if(!e)return this;this.set(e,t)}}),h.set(Array.prototype,a={external:!1,name:Array.prototype.constructor.name,cb:null}),n.defineClass=function(e,t){for(var n,r=Object.keys(t),s=1;s<r.length;s++){var a,i;(a=r[s-1])>(i=r[s])&&(r[s-1]=i,r[s]=a,s?s-=2:s--)}d.push(n={name:e,tag:r.toString(),proto:Object.getPrototypeOf(t),fields:Object.keys(t)});for(var o=1;o<n.fields.length;o++)if(n.fields[o]<n.fields[o-1]){let e=n.fields[o-1];n.fields[o-1]=n.fields[o],n.fields[o]=e,o>1&&(o-=2)}n.proto===Object.getPrototypeOf({})&&(n.proto=null)},n.toJSOX=n.registerToJSOX=function(e,t,n){if(t.prototype&&t.prototype===Object.prototype){var r=Object.keys(t).toString();if(b.get(r))throw new Error("Existing toJSOX has been registered for object type");b.set(r,{external:!0,name:e,cb:n})}else{if(h.get(t.prototype))throw new Error("Existing toJSOX has been registered for prototype");h.set(t.prototype,{external:!0,name:e||n.constructor.name,cb:n})}},n.fromJSOX=function(e,t,n){if(t||(t=function(){}.prototype),y.get(e))throw new Error("Existing fromJSOX has been registered for prototype");if(t&&!("constructor"in t))throw new Error("Please pass a prototype like thing...");y.set(e,{protoCon:t.prototype.constructor,cb:n})},n.registerFromJSOX=function(e,t){throw new Error("deprecated; please adjust code to use fromJSOX:"+e+t.toString())},n.addType=function(e,t,r,s){n.toJSOX(e,t,r),n.fromJSOX(e,t,s)},n.registerToFrom=function(e,t){throw new Error("registerToFrom deprecated; please use addType:"+e+t.toString())},n.stringifier=function(){var e=[],r='"';let s=new WeakMap;const o=[];var c=[];const u=new WeakMap,f=new Map;let p=null;const g=[];let y=!1;const m={defineClass(t,n){for(var r,s=Object.keys(n),a=1;a<s.length;a++){var i,o;(i=s[a-1])>(o=s[a])&&(s[a-1]=o,s[a]=i,a?a-=2:a--)}e.push(r={name:t,tag:s.toString(),proto:Object.getPrototypeOf(n),fields:Object.keys(n)});for(var l=1;l<r.fields.length;l++)if(r.fields[l]<r.fields[l-1]){let e=r.fields[l-1];r.fields[l-1]=r.fields[l],r.fields[l]=e,l>1&&(l-=2)}r.proto===Object.getPrototypeOf({})&&(r.proto=null)},setDefaultObjectToJSOX(e){p=e},isEncoding:e=>!!c.find(((t,n)=>t===e&&n<c.length-1)),encodeObject(e){return p?p.apply(e,[this]):e},stringify:(t,w,_)=>function(t,w,_){if(void 0===t)return"undefined";if(null===t)return;var x,N,O,j,S=!0;const E=typeof _,A=typeof w;if(x="",N="","number"===E)for(j=0;j<_;j+=1)N+=" ";else"string"===E&&(N=_);if(O=w,w&&"function"!==A&&("object"!==A||"number"!=typeof w.length))throw new Error("JSOX.stringify");o.length=0,s=new WeakMap;const I=D("",{"":t});return d.length=0,I;function T(e){return isNaN(e)?e in l||/([0-9-])/.test(e[0])||/((\n|\r|\t)|[ {}()<>!+*/.:,-])/.test(e)?r+n.escape(e)+r:e:["'",e.toString(),"'"].join("")}function D(t,n){function r(){var e=[];let t=o.length;for(let n=0;n<this.length;n+=1)o[t]=n,e[n]=D(n,this)||"null";return o.length=t,c.length=t,0===e.length?"[]":x?["[\n",x,e.join(",\n"+x),"\n",I,"]"].join(""):"["+e.join(",")+"]"}function s(){var e={tmp:null},t="{",n=!0;for(var[r,s]of this){e.tmp=s;var a=o.length;o[a]=r,t+=(n?"":",")+T(r)+":"+D("tmp",e),o.length=a,n=!1}return t+="}"}var l,w,_,j;S&&(a.cb=r,i.cb=s,S=!1);var E,A,I=x;let P,X=o.length,C=n[t],J="object"==typeof C;J&&null!==C&&p&&(g.find((e=>e===C))||(g.push(C),c[X]=C,C=p.apply(C,[m]),J="object"==typeof C,g.pop(),c.length=X,J="object"==typeof C));const M=null!=C&&Object.getPrototypeOf(C);var F=M&&(u.get(M)||h.get(M)||null),$=!F&&null!=C&&(f.get(Object.keys(C).toString())||b.get(Object.keys(C).toString())||null);if(F)var U=F&&F.cb||$&&$.cb;if(null!=C&&"function"==typeof U){if(x+=N,"object"==typeof C&&(_=v(C)))return"ref"+_;let e=U.call(C,m);C=e,x=I}else if("object"==typeof C&&(_=v(C)))return"ref"+_;switch("function"==typeof O&&(C=O.call(n,t,C)),typeof C){case"bigint":return C+"n";case"string":case"number":{let n="";return""===t&&(n=e.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(x?"\n":"")+d.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(x?"\n":"")+(x?"\n":"")),F&&F.external?n+F.name+C:$&&$.external?n+$.name+C:n+C}case"boolean":case"null":return String(C);case"object":if(_)return"ref"+_;if(!C)return"null";if(x+=N,E=null,A=[],O&&"object"==typeof O){for(j=O.length,E=k(C,O),l=0;l<j;l+=1)"string"==typeof O[l]&&(w=O[l],o[X]=w,(_=D(w,C))&&(E?A.push(_):A.push(T(w)+(x?": ":":")+_)));o.splice(X,1)}else{E=k(C);var B=[];for(w in C)if((!y||Object.prototype.propertyIsEnumerable.call(C,w))&&Object.prototype.hasOwnProperty.call(C,w)){var q;for(q=0;q<B.length;q++)if(B[q]>w){B.splice(q,0,w);break}q==B.length&&B.push(w)}for(q=0;q<B.length;q++)w=B[q],Object.prototype.hasOwnProperty.call(C,w)&&(o[X]=w,(_=D(w,C))&&(E?A.push(_):A.push(T(w)+(x?": ":":")+_)));o.splice(X,1)}P=""===t?(e.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(x?"\n":"")||d.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(x?"\n":""))+(x?"\n":""):"",F&&F.external&&(P+=T(F.name));var H=null;return E&&(H=T(E.name)),_=P+(0===A.length?"{}":x?(E?H:"")+"{\n"+x+A.join(",\n"+x)+"\n"+I+"}":(E?H:"")+"{"+A.join(",")+"}"),x=I,_}}}(t,w,_),setQuote(e){r=e},registerToJSOX(e,t,n){return this.toJSOX(e,t,n)},toJSOX(e,t,n){if(t.prototype&&t.prototype!==Object.prototype){if(u.get(t.prototype))throw new Error("Existing toJSOX has been registered for prototype");u.set(t.prototype,{external:!0,name:e||n.constructor.name,cb:n})}else{var r=Object.keys(t).toString();if(f.get(r))throw new Error("Existing toJSOX has been registered for object type");f.set(r,{external:!0,name:e,cb:n})}},get ignoreNonEnumerable(){return y},set ignoreNonEnumerable(e){y=e}};return m;function v(e){if(null!==e){var n=s.get(e);if(n)return n;s.set(e,t.stringify(o))}}function k(t,n){var r,s,a=Object.getPrototypeOf(t);if(s=e.find((e=>{if(e.proto&&e.proto===a)return!0})))return s;if(e.length||d.length){if(n)n=n.map((e=>"string"==typeof e?e:void 0)),r=n.toString();else{for(var i=Object.keys(t),o=1;o<i.length;o++){var l,c;(l=i[o-1])>(c=i[o])&&(i[o-1]=c,i[o]=l,o?o-=2:o--)}r=i.toString()}(s=e.find((e=>{if(e.tag===r)return!0})))||(s=d.find((e=>{if(e.tag===r)return!0})))}return s}};const w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$_",_={"~":-1,"=":-1,$:62,_:63,"+":62,"-":62,".":62,"/":63,",":63};for(var x=0;x<256;x++)x<64&&(_[w[x]]=x);function N(e){for(var t,n="",r=new Uint8Array(e),s=r.byteLength,a=s%3,i=s-a,o=0;o<i;o+=3)t=r[o]<<16|r[o+1]<<8|r[o+2],n+=w[(16515072&t)>>18]+w[(258048&t)>>12]+w[(4032&t)>>6]+w[63&t];return 1==a?(t=r[i],n+=w[(252&t)>>2]+w[(3&t)<<4]+"=="):2==a&&(t=r[i]<<8|r[i+1],n+=w[(64512&t)>>10]+w[(1008&t)>>4]+w[(15&t)<<2]+"="),n}function O(e){var t;t=e.length%4==1?3*((e.length+3)/4|0)-3:e.length%4==2?3*((e.length+3)/4|0)-2:e.length%4==3?3*((e.length+3)/4|0)-1:-1==_[e[e.length-3]]?3*((e.length+3)/4|0)-3:-1==_[e[e.length-2]]?3*((e.length+3)/4|0)-2:-1==_[e[e.length-1]]?3*((e.length+3)/4|0)-1:3*((e.length+3)/4|0);var n,r=new ArrayBuffer(t),s=new Uint8Array(r),a=e.length+3>>2;for(n=0;n<a;n++){var i=_[e[4*n]],o=4*n+1<e.length?_[e[4*n+1]]:-1,l=o>=0&&4*n+2<e.length?_[e[4*n+2]]:-1,c=l>=0&&4*n+3<e.length?_[e[4*n+3]]:-1;o>=0&&(s[3*n+0]=i<<2|o>>4),l>=0&&(s[3*n+1]=o<<4|l>>2&15),c>=0&&(s[3*n+2]=l<<6|63&c)}return r}Object.freeze(_),n.stringify=function(e,t,r){return n.stringifier().stringify(e,t,r)};[[0,256,[16767487,16739071,130048,3670016,0,16777208,16777215,8388607]]].map((e=>({firstChar:e[0],lastChar:e[1],bits:e[2]})));exports.JSOX=n;
