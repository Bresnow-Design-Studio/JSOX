import"util";var e=e||{};const t=JSON,n=e;!function(){const e="function"==typeof BigInt,r=["ab","u8","cu8","s8","u16","s16","u32","s32","u64","s64","f32","f64"];var a=null,s=null;const i=[ArrayBuffer,Uint8Array,Uint8ClampedArray,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,null,null,Float32Array,Float64Array],l=29,o=30,c=31,u={true:!0,false:!1,null:null,NaN:NaN,Infinity:1/0,undefined:void 0},f=[];function p(){var e=f.pop();return e||(e={context:0,current_proto:null,current_class:null,current_class_field:0,arrayType:-1,valueType:0,elements:null,element_array:null}),e}function g(e){f.push(e)}const h=[];function b(e){h.push(e)}n.escape=function(e){var t,n="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(n+="\\"),n+=e[t];return n};const y=new WeakMap,d=new Map,m=new Map,v=[];n.begin=function(t,n){const a={name:null,value_type:0,string:"",contains:null,className:null},s={line:1,col:1};let u,f=0;var y=new Map,d=0,v=!0,k=!1,w=!1,_=null,x=null,O=void 0,N=[],j={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t,this.length++},pop(){var e=this.last;return e?((this.last=e.prior)||(this.first=null),e.next=this.saved,this.last&&(this.last.next=null),e.next||(e.first=null),this.saved=e,this.length--,e.node):null},length:0},E=[],A={},I=null,T=null,P=0,C=-1,D=0,J=0,M=!1,X=!1,F=!1,U=!1,$=!1,B={first:null,last:null,saved:null,push(e){var t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t},shift(){var e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){var t=this.saved;this.saved=t.next,t.node=e,t.next=this.first,t.prior=null,this.first||(this.last=t),this.first=t}},q=null,H=!1,W=!1,z=!1,L=!1,R=!1,V=!1,G=!1,Q=0,Y=0,K=!1,Z=!1,ee=!1;function te(e){throw new Error(`${e} at ${f} [${s.line}:${s.col}]`)}return{fromJSOX(e,t,n){if(y.get(e))throw new Error("Existing fromJSOX has been registered for prototype");if(t||(t=function(){}),t&&!("constructor"in t))throw new Error("Please pass a prototype like thing...");y.set(e,{protoCon:t.prototype.constructor,cb:n})},registerFromJSOX(e,t){throw new Error("registerFromJSOX is deprecated, please update to use fromJSOX instead:"+e+t.toString())},finalError(){0!==J&&(1===J&&te("Comment began at end of document"),2===J&&console.log("Warning: '//' comment without end of line ended document"),3===J&&te("Open comment '/*' is missing close at end of document"),4===J&&te("Incomplete '/* *' close at end of document")),H&&te("Incomplete string")},value(){this.finalError();var e=_;return _=void 0,e},reset(){d=0,v=!0,B.last&&(B.last.next=B.save),B.save=B.first,B.first=B.last=null,j.last&&(j.last.next=j.save),j.length=0,j.save=B.first,j.first=j.last=null,N=[],O=void 0,D=0,E=[],A={},I=null,T=null,P=0,a.value_type=0,a.name=null,a.string="",a.className=null,s.line=1,s.col=1,w=!1,J=0,K=!1,H=!1,z=!1,L=!1,Z=!1},usePrototype(e,t){A[e]=t},write(e){var r;for("string"!=typeof e&&void 0!==e&&(e=String(e)),r=this._write(e,!1);r>0&&("function"==typeof n&&function e(t,r){var a,s,i=t[r];if(i&&"object"==typeof i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(void 0!==(s=e(i,a))?i[a]=s:delete i[a]);return n.call(t,r,i)}({"":_},""),_=t(_),!(r<2));r=this._write());},_write(t,n){var A,te,ne,re=0;function ae(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${f} (near '${ne.substr(f>4?f-4:0,f>4?3:f-1)}[${String.fromCodePoint(t)}]${ne.substr(f,10)}') [${s.line}:${s.col}]`)}function se(){a.value_type=0,a.string="",a.contains=null}function ie(){var t=null;switch(a.value_type){case 5:if(!(a.string.length>10||10==a.string.length&&a[0]>"2")||Z||$||U||X||(ee=!0),ee){if(e)return BigInt(a.string);throw new Error("no builtin BigInt()",0)}if(Z){const e=new Date(a.string);return isNaN(e.getTime())&&ae("Bad number format",A),e}return(w?-1:1)*Number(a.string);case 4:return a.className&&((t=y.get(a.className))||(t=m.get(a.className)),a.className=null,t&&t.cb)?t.cb.call(a.string):a.string;case 2:return!0;case 3:return!1;case 7:case 8:return NaN;case 9:return-1/0;case 10:return 1/0;case 1:return null;case-1:case 12:return;case 6:return a.className&&((t=y.get(a.className))||(t=m.get(a.className)),a.className=null,t&&t.cb)?a.contains=t.cb.call(a.contains):a.contains;case 13:if(C>=0){let e;return e=a.contains.length?S(a.contains[0]):S(a.string),0===C?e:new i[C](e)}if(-2===C){var n=x;let e;for(e=0;e<a.contains.length;e++){const t=a.contains[e];let r=n[a.contains[e]];if(!r){let t=j.first,s=0;for(;t&&s<a.contains.length;){const i=a.contains[s];if(t.next)if("number"==typeof i){const e=t.next.node.element_array;t.next.node.elements;if(e&&i>=e.length){if(s===a.contains.length-1){r=O;break}if(t.next.next&&i===e.length){r=t.next.next.node.elements,t=t.next,s++,n=r;continue}throw console.log("This is one broken path...",t,t.node,i),new Error("Array overflow in history.")}}else if(i!==t.next.node.name){r=t.next.node.elements[i],e=s;break}t=t.next,s++}}if(!r)throw new Error("Path did not resolve poperly."+a.contains+" at "+t+"("+e+")");n=r}return C=-3,n}return a.className&&((t=y.get(a.className))||(t=m.get(a.className)),a.className=null,t&&t.cb)?t.cb.call(a.contains):a.contains;default:console.log("Unhandled value conversion.",a)}}function le(){if(-3==C)return 6===a.value_type&&N.push(a.contains),void(C=-1);switch(a.value_type){case 12:N.push(void 0),delete N[N.length-1];break;default:N.push(ie())}se()}function oe(){if(-3===C)return O[a.name]=ie(),void(C=-1);12!==a.value_type&&(!a.name&&T&&(a.name=T.fields[P++]),O[a.name]=ie(),se())}function ce(e){if(0!==d){switch(w&&ae("Negative outside of quotes, being converted to a string (would lose count of leading '-' characters)",e),d){case c:switch(a.value_type){case 2:a.string+="true";break;case 3:a.string+="false";break;case 1:a.string+="null";break;case 10:a.string+="Infinity";break;case 9:a.string+="-Infinity",ae("Negative outside of quotes, being converted to a string",e);break;case 8:a.string+="NaN";break;case 7:a.string+="-NaN",ae("Negative outside of quotes, being converted to a string",e);break;case-1:a.string+="undefined";break;case 4:case 0:break;default:console.log("Value of type "+a.value_type+" is not restored...")}break;case 1:a.string+="t";break;case 2:a.string+="tr";break;case 3:a.string+="tru";break;case 5:a.string+="f";break;case 6:a.string+="fa";break;case 7:a.string+="fal";break;case 8:a.string+="fals";break;case 9:a.string+="n";break;case 10:a.string+="nu";break;case 11:a.string+="nul";break;case 12:a.string+="u";break;case 13:a.string+="un";break;case 14:a.string+="und";break;case 15:a.string+="unde";break;case 16:a.string+="undef";break;case 17:a.string+="undefi";break;case 18:a.string+="undefin";break;case 19:a.string+="undefine";break;case 20:a.string+="M";break;case 21:a.string+="Na";break;case 22:a.string+="I";break;case 23:a.string+="In";break;case 24:a.string+="Inf";break;case 25:a.string+="Infi";break;case 26:a.string+="Infin";break;case 27:a.string+="Infini";break;case 28:a.string+="Infinit";break;case 0:case l:case o:break;case 32:ae("String-keyword recovery fail (after whitespace)",e)}a.value_type=4,d<l&&(d=c)}else d=c,a.value_type=4;if(123==e)pe();else if(91==e)ge();else if(44==e);else{if(32==e||13==e||10==e||9==e||65279==e||8232==e||8233==e)return;44==e||125==e||93==e||58==e?ae("Invalid character near identifier",e):a.string+=u}}function ue(e){let t=0;for(;0==t&&f<ne.length;){u=ne.charAt(f);let n=ne.codePointAt(f++);if(n>=65536&&(u+=ne.charAt(f),f++),s.col++,n==e)z?(G?ae("Incomplete hexidecimal sequence",n):V?ae("Incomplete long unicode sequence",n):R&&ae("Incomplete unicode sequence",n),L?(L=!1,t=1):a.string+=u,z=!1):t=1;else if(z){if(R){if(125==n){a.string+=String.fromCodePoint(Q),R=!1,V=!1,z=!1;continue}if(Q*=16,n>=48&&n<=57)Q+=n-48;else if(n>=65&&n<=70)Q+=n-65+10;else{if(!(n>=97&&n<=102)){ae("(escaped character, parsing hex of \\u)",n),t=-1,R=!1,z=!1;continue}Q+=n-97+10}continue}if(G||V){if(0===Y&&123===n){R=!0;continue}if(Y<2||V&&Y<4){if(Q*=16,n>=48&&n<=57)Q+=n-48;else if(n>=65&&n<=70)Q+=n-65+10;else{if(!(n>=97&&n<=102)){ae(V?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",n),t=-1,G=!1,z=!1;continue}Q+=n-97+10}Y++,V?4==Y&&(a.string+=String.fromCodePoint(Q),V=!1,z=!1):2==Y&&(a.string+=String.fromCodePoint(Q),G=!1,z=!1);continue}}switch(n){case 13:L=!0,s.col=1;continue;case 8232:case 8233:s.col=1;case 10:L?L=!1:s.col=1,s.line++;break;case 116:a.string+="\t";break;case 98:a.string+="\b";break;case 110:a.string+="\n";break;case 114:a.string+="\r";break;case 102:a.string+="\f";break;case 48:a.string+="\0";break;case 120:G=!0,Y=0,Q=0;continue;case 117:V=!0,Y=0,Q=0;continue;default:a.string+=u}z=!1}else 92===n?z?(a.string+="\\",z=!1):(z=!0,Q=0,Y=0):(L&&(L=!1,s.line++,s.col=2),a.string+=u)}return t}function fe(){let e;for(;(e=f)<ne.length;){u=ne.charAt(e);let t=ne.codePointAt(f++);if(t>=256){f=e;break}if(95!=t)if(s.col++,t>=48&&t<=57)F&&($=!0),a.string+=u;else if(45==t||43==t)0==a.string.length||F&&!U&&!$?(45!=t||F||(w=!w),a.string+=u,U=!0):(a.string+=u,Z=!0);else{if(78==t){if(0==d)return W=!1,void(d=20);ae("fault while parsing number;",t);break}if(73==t){if(0==d)return W=!1,void(d=22);ae("fault while parsing number;",t);break}if(58==t&&Z)a.string+=u,Z=!0;else if(84==t&&Z)a.string+=u,Z=!0;else if(90==t&&Z)a.string+=u,Z=!0;else if(46==t){if(X||M||F){v=!1,ae("fault while parsing number;",t);break}a.string+=u,X=!0}else{if(110==t){ee=!0;break}if(120==t||98==t||111==t||88==t||66==t||79==t){if(M||"0"!=a.string){v=!1,ae("fault while parsing number;",t);break}M=!0,a.string+=u}else{if(101!=t&&69!=t){if(32==t||13==t||10==t||9==t||47==t||35==t||44==t||125==t||93==t||123==t||91==t||34==t||39==t||96==t||58==t){f=e;break}n&&(v=!1,ae("fault while parsing number;",t));break}if(F){v=!1,ae("fault while parsing number;",t);break}a.string+=u,F=!0}}}}n||f!=ne.length?(W=!1,a.value_type=5,0==D&&(K=!0)):W=!0}function pe(){let e,t,n=null,r={};if(d>0&&d<l&&ce(123),t=he(),0==D)if(d==l||d==c&&(t||a.string.length)){if(t&&t.protoDef&&t.protoDef.protocon&&(r=new t.protoDef.protocon,e=2),!t||!t.protoDef&&a.string){if(n=E.find((e=>e.name===a.string)),n)k?(n.fields.length=0,e=4):(r=new n.protoCon,e=5);else{const r=()=>{};E.push(n={name:a.string,protoCon:t&&t.protoDef&&t.protoDef.protoCon||r.constructor,fields:[]}),e=4}k=!1}T=n,d=0}else d=l,e=2;else if(d==l||1===D||3===D||5==D)if(0!=d||4==a.value_type){if(t&&t.protoDef)a.className=a.string,r=new t.protoDef.protoCon,e=2;else{if(n=E.find((e=>e.name===a.string)),n)e=5;else{function s(){}y.set(a.string,{protoCon:s.prototype.constructor,cb:null}),O=new s,e=2}r={}}d=0}else e=2,d=0;else{if(2==D&&0==d)return ae("fault while parsing; getting field name unexpected ",A),v=!1,!1;e=2}let i=p();return a.value_type=6,0===D?O=r:1==D||3!=D&&5!=D||(!a.name&&T&&(a.name=T.fields[P++]),O[a.name]=r),i.context=D,i.elements=O,i.element_array=N,i.name=a.name,i.current_proto=I,i.current_class=T,i.current_class_field=P,i.valueType=a.value_type,i.arrayType=-1==C?-3:C,i.className=a.className,a.className=null,a.name=null,I=t,T=n,P=0,O=r,x||(x=O),j.push(i),se(),D=e,!0}function ge(){if(d>0&&d<l&&ce(91),d==c&&a.string.length){var e=r.findIndex((e=>e===a.string));e>=0?(d=0,C=e,a.className=a.string,a.string=null):"ref"===a.string?(a.className=null,C=-2):y.get(a.string)||m.get(a.string)?a.className=a.string:ae(`Unknown type '${a.string}' specified for array`,A)}else if(2==D||d==l||d==o)return ae("Fault while parsing; while getting field name unexpected",A),v=!1,!1;{let e=p();a.value_type=13;let t=[];0==D?N=t:1==D?-1==C&&console.log("Pushing new opening array into existing array already RE-SET"):3==D&&(O[a.name]=t),e.context=D,e.elements=O,e.element_array=N,e.name=a.name,e.current_proto=I,e.current_class=T,e.current_class_field=P,e.valueType=a.value_type,e.arrayType=-1==C?-3:C,e.className=a.className,C=-1,a.className=null,a.name=null,I=null,T=null,P=0,N=t,x||(x=N),j.push(e),se(),D=1}return!0}function he(){const e={protoDef:null,cls:null};return((e.protoDef=y.get(a.string))||(e.protoDef=m.get(a.string)))&&(a.className||(a.className=a.string,a.string=null)),a.string&&(e.cls=E.find((e=>e.name===a.string))),e.protoDef||e.cls?e:null}if(!v)return-1;for(t&&t.length?((te=function(){var e=h.pop();return e?e.n=0:e={buf:null,n:0},e}()).buf=t,B.push(te)):(W&&(W=!1,a.value_type=5,0==D&&(K=!0),re=1),0!==D&&ae("Unclosed object at end of stream.",A));v&&(te=B.shift());){if(f=te.n,ne=te.buf,H){let e=ue(q);e<0?v=!1:e>0&&(H=!1,v&&(a.value_type=4))}for(W&&fe();!K&&v&&f<ne.length;)if(u=ne.charAt(f),(A=ne.codePointAt(f++))>=65536&&(u+=ne.charAt(f),f++),s.col++,J)if(1==J)if(42==A)J=3;else{if(47!=A)return ae("fault while parsing;",A);J=2}else 2==J?10!=A&&13!=A||(J=0):3==J?42==A&&(J=4):J=47==A?0:3;else{switch(A){case 47:J=1;break;case 123:pe();break;case 91:ge();break;case 58:if(5==D)d=0,a.name=a.string,a.string="",a.value_type=0;else if(2==D||4==D)if(4==D){if(!Object.keys(O).length){console.log("This is a full object, not a class def...",a.className);const e=()=>{};y.set(j.last.node.current_class.name,{protoCon:e.prototype.constructor,cb:null}),O=new e,D=3,a.name=a.string,d=0,a.string="",a.value_type=0,console.log("don't do default;s do a revive...")}}else 0!=d&&d!=c&&d!=l&&d!=o&&ce(32),d=0,a.name=a.string,a.string="",D=2===D?3:6,a.value_type=0;else{if(0==D){console.log("Override colon found, allow class redefinition",D),k=!0;break}ae(1==D?"(in array, got colon out of string):parsing fault;":3==D?"String unexpected":"(outside any object, got colon out of string):parsing fault;",A),v=!1}break;case 125:if(d==c&&(d=0),4==D)if(T){a.string&&T.fields.push(a.string),se();let e=j.pop();D=0,d=0,a.name=e.name,O=e.elements,N=e.element_array,T=e.current_class,P=e.current_class_field,C=e.arrayType,a.value_type=e.valueType,a.className=e.className,x=null,g(e)}else ae("State error; gathering class fields, and lost the class",A);else if(2==D||5==D){0!=a.value_type&&(T&&(a.name=T.fields[P++]),oe()),a.value_type=6,I&&I.protoDef&&(console.log("SOMETHING SHOULD AHVE BEEN REPLACED HERE??",I),console.log("The other version only revives on init"),O=new I.protoDef.cb(O,void 0,void 0)),a.contains=O,a.string="";let e=j.pop();D=e.context,a.name=e.name,O=e.elements,N=e.element_array,T=e.current_class,I=e.current_proto,P=e.current_class_field,C=e.arrayType,a.value_type=e.valueType,a.className=e.className,g(e),0==D&&(K=!0)}else if(3==D){0===a.value_type&&ae("Fault while parsing; unexpected",A),oe(),a.value_type=6,a.contains=O,d=0;var be=j.pop();D=be.context,a.name=be.name,O=be.elements,I=be.current_proto,T=be.current_class,P=be.current_class_field,C=be.arrayType,a.value_type=be.valueType,a.className=be.className,N=be.element_array,g(be),0==D&&(K=!0)}else ae("Fault while parsing; unexpected",A),v=!1;w=!1;break;case 93:if(d>=o&&(d=0),1==D){0!=a.value_type&&le(),a.contains=N;{let e=j.pop();a.name=e.name,a.className=e.className,D=e.context,O=e.elements,N=e.element_array,I=e.current_proto,T=e.current_class,P=e.current_class_field,C=e.arrayType,a.value_type=e.valueType,g(e)}a.value_type=13,0==D&&(K=!0)}else ae(`bad context ${D}; fault while parsing`,A),v=!1;w=!1;break;case 44:d<c&&0!=d&&ce(A),d!=c&&d!=l||(d=0),4==D?T?(T.fields.push(a.string),a.string="",d=l):ae("State error; gathering class fields, and lost the class",A):2==D?T?(a.name=T.fields[P++],0!=a.value_type&&(oe(),se())):(a.string||a.value_type)&&ae("State error; comma in field name and/or lost the class",A):5==D?(T?(-3==C||a.name||(a.name=T.fields[P++]),0!=a.value_type&&(-3!=C&&oe(),se())):0!=a.value_type&&(oe(),se()),a.name=null):1==D?(0==a.value_type&&(a.value_type=12),le(),se()):3==D&&0!=a.value_type?(D=2,0!=a.value_type&&(oe(),se()),d=0):(v=!1,ae("bad context; excessive commas while parsing;",A)),w=!1;break;default:switch(A){default:if(0!=D&&(3!=D||d!=l)&&2!=D&&d!=l&&4!=D){if(0==d&&(A>=48&&A<=57||43==A||46==A||45==A))M=!1,F=!1,Z=!1,ee=!1,U=!1,$=!1,X=!1,a.string=u,te.n=f,fe();else if(0==a.value_type)0!=d?ce(A):(d=c,a.string+=u);else if(2==D)ae("Multiple values found in field name",A);else if(3==D)if(4!=a.value_type&&(6!=a.value_type&&13!=a.value_type||ae("String unexpected",A),ce(A)),d==o){he()?a.string=u:ae("String unexpected",A)}else d==c?a.string+=u:ae("String unexpected",A);else if(1==D){if(d==o){a.className||he(),a.string+=u;break}d==c&&(a.string+=u)}break}switch(A){case 96:case 34:case 39:if(0==d||d==l){a.string.length&&(a.className=a.string,a.string=""),ue(A)?a.value_type=4:(q=A,H=!0)}else ae("fault while parsing; quote not at start of field name",A);break;case 10:s.line++,s.col=1;case 13:case 32:case 8232:case 8233:case 9:case 65279:if(0===D&&d===c){d=0,0===D&&(K=!0);break}if(0===d||d===o){0==D&&a.value_type&&(K=!0);break}if(d===l){if(0===D){d=0,K=!0;break}a.string.length&&(d=o)}else v=!1,ae("fault while parsing; whitepsace unexpected",A);break;default:if(0==d&&(A>=48&&A<=57||43==A||46==A||45==A)){M=!1,F=!1,Z=!1,ee=!1,U=!1,$=!1,X=!1,a.string=u,te.n=f,fe();break}if(d===o&&(v=!1,ae("fault while parsing; character unexpected",A)),0===d){d=l,a.value_type=4,a.string+=u;break}if(0==a.value_type)0!==d&&d!==c&&ce(A);else{if(d===c||d===l){a.string+=u;break}if(2==D){if(d==l){a.string+=u;break}ae("Multiple values found in field name",A)}3==D&&ae("String unexpected",A)}}break;case 96:case 34:case 39:ue(A)?(a.value_type=4,d=c):(q=A,H=!0);break;case 10:s.line++,s.col=1;case 32:case 9:case 13:case 8232:case 8233:case 65279:if(d==c){if(0==D){d=0,K=!0;break}if(3==D){d=32;break}if(2==D){d=o;break}if(1==D){d=o;break}}if(0==d||d==o)break;d==l?a.string.length&&(d=o):d<c&&ce(A);break;case 116:0==d?d=1:27==d?d=28:ce(A);break;case 114:1==d?d=2:ce(A);break;case 117:2==d?d=3:9==d?d=10:0==d?d=12:ce(A);break;case 101:3==d?(a.value_type=2,d=c):8==d?(a.value_type=3,d=c):14==d?d=15:18==d?d=19:ce(A);break;case 110:0==d?d=9:12==d?d=13:17==d?d=18:22==d?d=23:25==d?d=26:ce(A);break;case 100:13==d?d=14:19==d?(a.value_type=-1,d=c):ce(A);break;case 105:16==d?d=17:24==d?d=25:26==d?d=27:ce(A);break;case 108:10==d?d=11:11==d?(a.value_type=1,d=c):6==d?d=7:ce(A);break;case 102:0==d?d=5:15==d?d=16:23==d?d=24:ce(A);break;case 97:5==d?d=6:20==d?d=21:ce(A);break;case 115:7==d?d=8:ce(A);break;case 73:0==d?d=22:ce(A);break;case 78:0==d?d=20:21==d?(a.value_type=w?7:8,w=!1,d=c):ce(A);break;case 121:28==d?(a.value_type=w?9:10,w=!1,d=c):ce(A);break;case 45:0==d?w=!w:ce(A)}}if(K){d==c&&(d=0);break}}if(f==ne.length?(b(te),H||W||2==D?re=0:0!=D||0==a.value_type&&!_||(K=!0,re=1)):(te.n=f,B.unshift(te),re=2),K){x=null;break}}return v?(K&&0!=a.value_type&&(d=0,_=ie(),w=!1,a.string="",a.value_type=0),K=!1,re):-1}}};const k=[Object.freeze(n.begin())];var w=0;function _(){return this&&this.valueOf()}n.parse=function(e,t){var r,a=w++;k.length<=a&&k.push(Object.freeze(n.begin())),r=k[a],"string"!=typeof e&&(e=String(e)),r.reset();const s=r._write(e,!0);if(s>0){var i=r.value();if(void 0===i&&s>1)throw new Error("Pending value could not complete");return i="function"==typeof t?function e(n,r){var a,s,i=n[r];if(i&&"object"==typeof i)for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(void 0!==(s=e(i,a))?i[a]=s:delete i[a]);return console.log("SO this calls deeply?",r,i),t.call(n,r,i)}({"":i},""):i,w--,i}r.finalError()},y.set(Object.prototype,{external:!1,name:Object.prototype.constructor.name,cb:null}),y.set(Date.prototype,{external:!1,name:"Date",cb:function(){var e,t,n=-this.getTimezoneOffset(),r=n>=0?"+":"-",a=function(e){var t=Math.floor(Math.abs(e));return(t<10?"0":"")+t};return[this.getFullYear(),"-",a(this.getMonth()+1),"-",a(this.getDate()),"T",a(this.getHours()),":",a(this.getMinutes()),":",a(this.getSeconds()),"."+(e=this.getMilliseconds(),t=Math.floor(Math.abs(e)),(t<100?"0":"")+(t<10?"0":"")+t)+r,a(n/60),":",a(n%60)].join("")}}),y.set(Boolean.prototype,{external:!1,name:"Boolean",cb:_}),y.set(Number.prototype,{external:!1,name:"Number",cb:function(){return isNaN(this)?"NaN":isFinite(this)?String(this):this<0?"-Infinity":"Infinity"}}),y.set(String.prototype,{external:!1,name:"String",cb:function(){return'"'+n.escape(_.apply(this))+'"'}}),"function"==typeof BigInt&&y.set(BigInt.prototype,{external:!1,name:"BigInt",cb:function(){return this+"n"}}),y.set(ArrayBuffer.prototype,{external:!0,name:"ab",cb:function(){return"["+j(this)+"]"}}),y.set(Uint8Array.prototype,{external:!0,name:"u8",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Uint8ClampedArray.prototype,{external:!0,name:"uc8",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Int8Array.prototype,{external:!0,name:"s8",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Uint16Array.prototype,{external:!0,name:"u16",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Int16Array.prototype,{external:!0,name:"s16",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Uint32Array.prototype,{external:!0,name:"u32",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Int32Array.prototype,{external:!0,name:"s32",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Float32Array.prototype,{external:!0,name:"f32",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Float64Array.prototype,{external:!0,name:"f64",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Float64Array.prototype,{external:!0,name:"f64",cb:function(){return"["+j(this.buffer)+"]"}}),y.set(Map.prototype,s={external:!0,name:"map",cb:null}),m.set("map",{protoCon:Map.constructor,cb:function(e,t){return e&&this.set(e,t),this}}),y.set(Array.prototype,a={external:!1,name:Array.prototype.constructor.name,cb:null}),n.defineClass=function(e,t){for(var n,r=Object.keys(t),a=1;a<r.length;a++){var s,i;(s=r[a-1])>(i=r[a])&&(r[a-1]=i,r[a]=s,a?a-=2:a--)}v.push(n={name:e,tag:r.toString(),proto:Object.getPrototypeOf(t),fields:Object.keys(t)});for(var l=1;l<n.fields.length;l++)if(n.fields[l]<n.fields[l-1]){let e=n.fields[l-1];n.fields[l-1]=n.fields[l],n.fields[l]=e,l>1&&(l-=2)}n.proto===Object.getPrototypeOf({})&&(n.proto=null)},n.toJSOX=n.registerToJSOX=function(e,t,n){if(t.prototype&&t.prototype===Object.prototype){var r=Object.keys(t).toString();if(d.get(r))throw new Error("Existing toJSOX has been registered for object type");d.set(r,{external:!0,name:e,cb:n})}else{if(y.get(t.prototype))throw new Error("Existing toJSOX has been registered for prototype");y.set(t.prototype,{external:!0,name:e||n.constructor.name,cb:n})}},n.fromJSOX=function(e,t,n){if(t||(t=function(){}.prototype),m.get(e))throw new Error("Existing fromJSOX has been registered for prototype");if(t&&!("constructor"in t))throw new Error("Please pass a prototype like thing...");m.set(e,{protoCon:t.prototype.constructor,cb:n})},n.registerFromJSOX=function(e,t){throw new Error("deprecated; please adjust code to use fromJSOX:"+e+t.toString())},n.addType=function(e,t,r,a){n.toJSOX(e,t,r),n.fromJSOX(e,t,a)},n.registerToFrom=function(e,t){throw new Error("registerToFrom deprecated; please use addType:"+e+t.toString())},n.stringifier=function(){var e=[],r='"';let i=new WeakMap;const l=[];var o=[];const c=new WeakMap,f=new Map;let p=null;const g=[];let h=!1;const b={defineClass(t,n){for(var r,a=Object.keys(n),s=1;s<a.length;s++){var i,l;(i=a[s-1])>(l=a[s])&&(a[s-1]=l,a[s]=i,s?s-=2:s--)}e.push(r={name:t,tag:a.toString(),proto:Object.getPrototypeOf(n),fields:Object.keys(n)});for(var o=1;o<r.fields.length;o++)if(r.fields[o]<r.fields[o-1]){let e=r.fields[o-1];r.fields[o-1]=r.fields[o],r.fields[o]=e,o>1&&(o-=2)}r.proto===Object.getPrototypeOf({})&&(r.proto=null)},setDefaultObjectToJSOX(e){p=e},isEncoding:e=>!!o.find(((t,n)=>t===e&&n<o.length-1)),encodeObject(e){return p?p.apply(e,[this]):e},stringify:(t,v,w)=>function(t,v,w){if(void 0===t)return"undefined";if(null===t)return;var _,x,O,N,j=!0;const S=typeof w,E=typeof v;if(_="",x="","number"===S)for(N=0;N<w;N+=1)x+=" ";else"string"===S&&(x=w);if(O=v,v&&"function"!==E&&("object"!==E||"number"!=typeof v.length))throw new Error("JSOX.stringify");return l.length=0,i=new WeakMap,I("",{"":t});function A(e){return isNaN(e)?e in u||/([0-9-])/.test(e[0])||/((\n|\r|\t)|[ {}()<>!+*/.:,-])/.test(e)?r+n.escape(e)+r:e:["'",e.toString(),"'"].join("")}function I(t,n){function r(){var e=[];let t=l.length;for(let n=0;n<this.length;n+=1)l[t]=n,e[n]=I(n,this)||"null";return l.length=t,o.length=t,0===e.length?"[]":_?["[\n",_,e.join(",\n"+_),"\n",T,"]"].join(""):"["+e.join(",")+"]"}function i(){var e={tmp:null},t="{",n=!0;for(var[r,a]of this){e.tmp=a;var s=l.length;l[s]=r,t+=(n?"":",")+A(r)+":"+I("tmp",e),l.length=s,n=!1}return t+="}"}var u,v,w,N;j&&(a.cb=r,s.cb=i,j=!1),a.cb=r;var S,E,T=_;let P=l.length;var C=n[t];let D,J="object"==typeof C;J&&null!==C&&p&&(g.find((e=>e===C))||(g.push(C),o[P]=C,J="object"==typeof(C=p.apply(C,[b])),g.pop(),o.length=P,J="object"==typeof C));var M=null!=C&&(c.get(Object.getPrototypeOf(C))||y.get(Object.getPrototypeOf(C))||null),X=!M&&null!=C&&(f.get(Object.keys(C).toString())||d.get(Object.keys(C).toString())||null),F=M&&M.cb||X&&X.cb;if(null!=C&&"function"==typeof F){if(_+=x,"object"==typeof C&&(w=m(C)))return"ref"+w;let e=F.apply(C);C=e,_=T}else if("object"==typeof C&&(w=m(C)))return"ref"+w;switch("function"==typeof O&&(C=O.call(n,t,C)),typeof C){case"string":case"number":{let n="";return""===t&&(n=e.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(_?"\n":"")+(_?"\n":"")),M&&M.external?n+M.name+C:X&&X.external?n+X.name+C:n+C}case"boolean":case"null":return String(C);case"object":if(w)return"ref"+w;if(!C)return"null";if(_+=x,S=null,E=[],O&&"object"==typeof O){for(N=O.length,S=k(C,O),u=0;u<N;u+=1)"string"==typeof O[u]&&(v=O[u],l[P]=v,(w=I(v,C))&&(S?E.push(w):E.push(A(v)+(_?": ":":")+w)));l.splice(P,1)}else{S=k(C);var U=[];for(v in C)if((!h||Object.prototype.propertyIsEnumerable.call(C,v))&&Object.prototype.hasOwnProperty.call(C,v)){var $;for($=0;$<U.length;$++)if(U[$]>v){U.splice($,0,v);break}$==U.length&&U.push(v)}for($=0;$<U.length;$++)v=U[$],Object.prototype.hasOwnProperty.call(C,v)&&(l[P]=v,(w=I(v,C))&&(S?E.push(w):E.push(A(v)+(_?": ":":")+w)));l.splice(P,1)}D=""===t?e.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(_?"\n":"")+(_?"\n":""):"",M&&M.external&&(""===t?D+=M.name:D=D+'"'+M.name+'"');var B=null;return S&&(B=A(S.name)),w=D+(0===E.length?"{}":_?(S?B:"")+"{\n"+_+E.join(",\n"+_)+"\n"+T+"}":(S?B:"")+"{"+E.join(",")+"}"),_=T,w}}}(t,v,w),setQuote(e){r=e},registerToJSOX(e,t,n){if(t.prototype&&t.prototype!==Object.prototype){if(c.get(t))throw new Error("Existing toJSOX has been registered for prototype");c.set(t,{external:!0,name:e||n.constructor.name,cb:n})}else{var r=Object.keys(t).toString();if(f.get(r))throw new Error("Existing toJSOX has been registered for object type");f.set(r,{external:!0,name:e,cb:n})}},get ignoreNonEnumerable(){return h},set ignoreNonEnumerable(e){h=e}};return b;function m(e){if(null!==e){var n=i.get(e);if(n)return n;i.set(e,t.stringify(l))}}function k(t,n){var r,a,s=Object.getPrototypeOf(t);if(a=e.find((e=>{if(e.proto&&e.proto===s)return!0})))return a;if(e.length||v.length){if(n)n=n.map((e=>"string"==typeof e?e:void 0)),r=n.toString();else{for(var i=Object.keys(t),l=1;l<i.length;l++){var o,c;(o=i[l-1])>(c=i[l])&&(i[l-1]=c,i[l]=o,l?l-=2:l--)}r=i.toString()}(a=e.find((e=>{if(e.tag===r)return!0})))||(a=v.find((e=>{if(e.tag===r)return!0})))}return a}};const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O={"~":-1,"=":-1,$:62,_:63,"+":62,"-":62,".":62,"/":63,",":63};for(var N=0;N<256;N++)N<64&&(O[x[N]]=N);function j(e){for(var t,n="",r=new Uint8Array(e),a=r.byteLength,s=a%3,i=a-s,l=0;l<i;l+=3)t=r[l]<<16|r[l+1]<<8|r[l+2],n+=x[(16515072&t)>>18]+x[(258048&t)>>12]+x[(4032&t)>>6]+x[63&t];return 1==s?(t=r[i],n+=x[(252&t)>>2]+x[(3&t)<<4]+"=="):2==s&&(t=r[i]<<8|r[i+1],n+=x[(64512&t)>>10]+x[(1008&t)>>4]+x[(15&t)<<2]+"="),n}function S(e){var t;t=e.length%4==1?3*((e.length+3)/4|0)-3:e.length%4==2?3*((e.length+3)/4|0)-2:e.length%4==3?3*((e.length+3)/4|0)-1:-1==O[e[e.length-3]]?3*((e.length+3)/4|0)-3:-1==O[e[e.length-2]]?3*((e.length+3)/4|0)-2:-1==O[e[e.length-1]]?3*((e.length+3)/4|0)-1:3*((e.length+3)/4|0);var n,r=new ArrayBuffer(t),a=new Uint8Array(r),s=e.length+3>>2;for(n=0;n<s;n++){var i=O[e[4*n]],l=4*n+1<e.length?O[e[4*n+1]]:-1,o=l>=0&&4*n+2<e.length?O[e[4*n+2]]:-1,c=o>=0&&4*n+3<e.length?O[e[4*n+3]]:-1;l>=0&&(a[3*n+0]=i<<2|l>>4),o>=0&&(a[3*n+1]=l<<4|o>>2&15),c>=0&&(a[3*n+2]=o<<6|63&c)}return r}Object.freeze(O),n.stringify=function(e,t,r){return n.stringifier().stringify(e,t,r)},[[0,256,[16767487,16739071,130048,3670016,0,16777208,16777215,8388607]]].map((e=>({firstChar:e[0],lastChar:e[1],bits:e[2]})))}();var r={};export default r;
